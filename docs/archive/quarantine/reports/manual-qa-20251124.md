# Manual QA Report — 24 Nov 2025

Environment: local Next.js dev server (`npm run dev`), Supabase project `hmmqhwnxylqcbffjffpj`, seeded vendor `qa-playwright-featured@example.com`.

## Directory / Search
- `POST /api/search` payload `{ "query": "handmade", "suburb": "Carlton", "session_id": "manual-qa-20251124", "tier": "pro" }`
- Response `200 OK`, result payload stored in `/tmp/qa_search.json`. Supabase query confirms hashed entry inserted into `search_logs` with session_id `manual-qa-20251124` (hash `791085bb...`).

## Vendor Auth & Product Listing
- `POST /api/auth/login` for QA vendor returned `200` (`/tmp/qa_login.json`).
- `GET /api/vendor/products` with returned JWT → `200`, stats reflect 5 published Playwright products.

## Tier Change (FIFO)
- `PATCH /api/vendor/tier` from Basic→Pro (QA vendor after downgrade) returned `200` (`/tmp/qa_tier.json`), `unpublishedCount: 0` because vendor already within cap.

## Featured Slot Purchase (Stripe Test)
- `POST /api/vendor/featured-slots` with `{ "suburb": "Melbourne", "lga_id": 17 }` returned `201` (`/tmp/qa_featured.json`). Response included live Checkout URL + sessionId for manual verification.

All requests executed at ~05:53–05:55 UTC; raw responses retained under `/tmp/qa_*.json` during this session.

## 24 Nov 2025 — Tier Downgrade Email + Dispute Close Audit
- `npm run test:unit` @ 17:12 AEDT — new Vitest coverage (`tests/unit/webhook-handler.test.ts`) asserts:
  - `charge.dispute.closed` events with outcome `won` decrement `vendors.dispute_count`.
  - Stripe subscription downgrades (metadata tier=basic) trigger FIFO enforcement and queue a `sendTierDowngradeEmail` when products are unpublished.
- Test logs stored under `test-results/.last-run.json` for traceability.

## 24 Nov 2025 — Featured Badge Evidence + Manual E2E Workflow
- Captured `reports/assets/featured-badge-20251124.png` via `npx playwright screenshot …/directory` while `npm run dev` was live; screenshot shows Directory hero banner + featured badge ribbon (Upgrade CTA + badge icon at top of page).
- Verified `products.featured` index removed by running `psql … select indexname from pg_indexes where tablename='products';` — output lists only current indexes (`products_pkey`, `idx_products_vendor`, etc.) with no legacy `idx_products_featured`.
- Manual agent-style E2E run on 24 Nov 2025:
  1. Planner/Implementer steps already finished; revalidated search telemetry curl (`POST /api/search` with session `agent-workflow-20251124` → 200 OK).
  2. Ran `npm run stripe:featured-qa` to execute featured-slot checkout script; generated report `reports/archive/2025-11-24/featured-slot-qa-1763965662637.md`.
  3. Re-ran `npm run test:unit` @ 17:28 AEDT (Vitest 29 tests passing) after the QA script.
